#include <stdio.h>
#include <string.h>

void good_function() {
    printf("This is the normal, safe function.\n");
}

void malicious_code() {
    printf("!!! YOU HAVE BEEN HACKED !!!\n");
}

void vulnerable_call(char* input) {
    char buffer[32];
    void (*function_ptr)() = &good_function;  // Function pointer on stack

    // VULNERABILITY: Overflow can overwrite function_ptr
    strcpy(buffer, input);

    function_ptr();  // Calls whatever address is in function_ptr
}

int main() {
    printf("Address of malicious_code is %p\n", &malicious_code);
    
    char attack_string[64];
    memset(attack_string, 'A', 32);  // Fill buffer
    
    // Attacker would append address of malicious_code here
    // Format: [32 bytes padding] + [address of malicious_code]
    vulnerable_call("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA");
    
    return 0;
}
