#include <stdio.h>
#include <string.h>

void good_function() {
    printf("This is the normal, safe function.\n");
}

void safe_call(char* input) {
    char buffer[32];
    void (*function_ptr)() = &good_function;

    // FIX: Use snprintf() to prevent the overflow.
    snprintf(buffer, sizeof(buffer), "%s", input);

    // Because the buffer overflow is prevented,
    // 'function_ptr' cannot be overwritten by the attacker.
    // It will *always* safely point to 'good_function'.
    function_ptr();
}

int main() {
    char* long_string = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";
    safe_call(long_string); // Correctly calls good_function
    return 0;
}